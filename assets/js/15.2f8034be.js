(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{508:function(v,_,a){"use strict";a.r(_);var t=a(6),e=Object(t.a)({},(function(){var v=this,_=v.$createElement,a=v._self._c||_;return a("ContentSlotsDistributor",{attrs:{"slot-key":v.$parent.slotKey}},[a("h1",{attrs:{id:"为什么需要垃圾回收"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#为什么需要垃圾回收"}},[v._v("#")]),v._v(" 为什么需要垃圾回收")]),v._v(" "),a("p",[v._v("内存是有限的，并且V8限制了内存的大小，大致是1.4G")]),v._v(" "),a("p",[a("strong",[v._v("V8为什么要限制？")])]),v._v(" "),a("ul",[a("li",[v._v("表面： V8被设计的时候只用于浏览器，不太可能遇到消耗大量内存的场景")]),v._v(" "),a("li",[v._v("深层： V8的垃圾回收机制，回收内存是非常耗时的，大内存的情况下，会引起javascript线程暂停")])]),v._v(" "),a("h1",{attrs:{id:"垃圾回收算法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#垃圾回收算法"}},[v._v("#")]),v._v(" 垃圾回收算法")]),v._v(" "),a("p",[v._v("V8将堆分为"),a("code",[v._v("新生代")]),v._v(" 和 "),a("code",[v._v("老生代")]),v._v(" 两类")]),v._v(" "),a("p",[a("strong",[v._v("新生代")]),v._v(": 64位：16M ,  32位：8M")]),v._v(" "),a("p",[a("strong",[v._v("老生代:")]),v._v(" 62位： 1400M，32位：700M")]),v._v(" "),a("p",[v._v("node中使用的也是V8，限制同样存在，可通过参数配置最大内存 "),a("strong",[v._v("（只能在启动时就配置好）")])]),v._v(" "),a("p",[v._v("设置老生代： --max-old-space-size")]),v._v(" "),a("p",[v._v("设置新生代： --max-new-space-size")]),v._v(" "),a("ul",[a("li",[v._v("副垃圾回收器(新生代)：scavenge")]),v._v(" "),a("li",[v._v("主垃圾回收器(老生代)：mark-sweep && mark-compact")])]),v._v(" "),a("h2",{attrs:{id:"scavenge"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#scavenge"}},[v._v("#")]),v._v(" Scavenge")]),v._v(" "),a("p",[v._v("将新生代堆分为两部分：")]),v._v(" "),a("p",[v._v("from-space: 处于使用状态")]),v._v(" "),a("p",[v._v("to-space:\t处于闲置状态")]),v._v(" "),a("p",[a("strong",[v._v("执行垃圾回收时：")]),v._v(" 检查form-space中存活的对象，这些存活的对象被复制到to-space中，将非存活的对象空间释放，完成复制后，将form-space与to-space角色互换。")]),v._v(" "),a("p",[a("img",{attrs:{src:"/img/gc/image-20210713093450464.png",alt:""}})]),v._v(" "),a("p",[v._v("在复制到to-space的过程中，检查对象是够经过一次Scavenge, 或to-space内存是否超过限制总的25%。满足这两点则将对象移动到老生代。")]),v._v(" "),a("p",[a("strong",[v._v("限制25%是由于to-space会和from-space角色互换，太大会导致后续的内存分配。")])]),v._v(" "),a("p",[a("img",{attrs:{src:"/img/gc/image-20210713094249854.png",alt:"image-20210713094249854"}})]),v._v(" "),a("p",[a("img",{attrs:{src:"/img/gc/image-20210713094318929.png",alt:"image-20210713094318929"}})]),v._v(" "),a("p",[a("strong",[v._v("Mark-Sweep & Mark-Compact")])]),v._v(" "),a("p",[a("code",[v._v("标记")]),v._v(" ： 我在网上看见有的人把根对象理解为了 JavaScript 中的全局对象。我认为这样去理解是解释不通的。因为在运行的某一时刻，垃圾收集收集器开始运行，通过全局对象是没有办法访问到整个引用链的。全局对象和其他对象间并不是一个树形的关联关系。")]),v._v(" "),a("p",[v._v("根据 JavaScript 高级程序设计中对标记清除的描述，我认为将这个跟对象理解为当前的执行上下文对象比较准确，因为通过当前的执行上下文对象可以访问到当前环境中的变量，也可以通过作用域链去访问到其他上下文中的活动对象，从而可以判断得到所有可以获得的对象和所有不能获得的对象。")]),v._v(" "),a("p",[a("strong",[v._v("Mark-Sweep")]),v._v(" :")]),v._v(" "),a("p",[v._v("​\t"),a("code",[v._v("标记")]),v._v("**(怎么标记？)**老生代存活的对象，清除未标记的对象， 黑色表示，未标记对象（需要被清除的对象）")]),v._v(" "),a("p",[a("img",{attrs:{src:"/img/gc/image-20210713094821447.png",alt:"image-20210713094821447"}})]),v._v(" "),a("p",[v._v("​\t"),a("strong",[v._v("存在的问题：")]),v._v(" 清除后，会导致内存碎片，不易后续分配，可能在分配大的对象时，无法完成此次分配。")]),v._v(" "),a("p",[a("strong",[v._v("Mark-Compact：")]),v._v(" 用于解决内存碎片问题")]),v._v(" "),a("p",[v._v("​\t将存活的对象移动到 一端，白色的表示存活对象， 灰色表示存活对象移动后留下的空洞，灰色死亡对象")]),v._v(" "),a("p",[a("img",{attrs:{src:"/img/gc/image-20210713095445049.png",alt:"image-20210713095445049"}})]),v._v(" "),a("p",[v._v("完成移动后，就可以直接清除最右边的存活对象后面的内存区域完成回收。")]),v._v(" "),a("p",[a("code",[v._v("mark-sweep")]),v._v("和"),a("code",[v._v("mark-compact")]),v._v("是配合使用的， "),a("code",[v._v("mark-compact")]),v._v(" 执行较慢，在V8中主要使用"),a("code",[v._v("mark-sweep")]),v._v(" 当老生代空间不足以分配新生代移动过来的对象时，使用"),a("code",[v._v("mark-compact")])]),v._v(" "),a("p",[v._v("Incremental Marking：增量标记")]),v._v(" "),a("p",[v._v("​\t由于垃圾回收可能会导致js逻辑异常，所以垃圾回收时，需要将应用逻辑停止，回收完后再恢复执行。")]),v._v(" "),a("p",[v._v("​\t新生代由于较小，影响不大。")]),v._v(" "),a("p",[v._v("​\t老生代，采用增量标记，js与垃圾回收标记交替进行")]),v._v(" "),a("p",[a("img",{attrs:{src:"/img/gc/image-20210713100712732.png",alt:"image-20210713100712732"}})]),v._v(" "),a("p",[v._v("V8后续还引入了延迟清理（lazy sweeping）与增量式整理（incrementalcompaction），让清理与整理动作也变成增量式的")])])}),[],!1,null,null,null);_.default=e.exports}}]);